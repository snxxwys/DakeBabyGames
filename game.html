<html>
    <head>
        <title>Dake Baby Games</title> 
        <link rel="icon" href="imgs/logoIcon.png">
        <link rel="stylesheet" href="css/game.css">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

        <script src="js/main.js"></script>
    </head>

    <body onload="checkCookie()">

        <div class="header">
            <a href="index.html"><img id="logoIcon" alt="DBG Logo - Home" src="imgs/logoIcon.png"></a>

            <nav class="topbar">
                <a id="selected" href="index.html">Home</a>
                
                <a href="gamehub.html">Game Hub</a>
                
                <a href="forms.html">Forms</a>
                
                <a href="dakebabynews.html">DakeBabyNews</a>
            </nav>

            <button class="darkmodebutton" type="button" onclick="toggleDarkMode()"><img src="imgs/moon.png" class="darkmodeimage"></button>
        </div>

        <h1 id="gameName">Game Name</h1>

        <div class="gameEmbed">
            <iframe class="gameEmbed" scrolling="no" src="" allowfullscreen="true"></iframe>
        </div>

        <button id="fullscreen"><h3>Fullscreen</h3></button>

       <script type="module">
            import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

            const SUPABASE_URL = 'https://hvgjigwtjzkvznmxfrgk.supabase.co'
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2Z2ppZ3d0anprdnpubXhmcmdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NzkyNzksImV4cCI6MjA3MjA1NTI3OX0.OeQ_4UPRqTepNp36CG8RwEnb1kgdHNGIzt8NR0gM6fw'

            const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
            const params = new URLSearchParams(window.location.search)
            const title = params.get('title')

            if (title) {
                document.getElementById('gameName').textContent = title
                const { data, error } = await supabase
                    .from('games')
                    .select('embedCode')
                    .eq('name', title)
                    .single()
            if (!error && data) {
                if (data.embedCode.startsWith('https')) {
                    document.querySelector('iframe.gameEmbed').src = data.embedCode
                } else {
                    document.querySelector('iframe.gameEmbed').srcdoc = data.embedCode
                }
            }
            }

            document.getElementById('fullscreen').addEventListener('click', () => {
            const iframe = document.querySelector('iframe.gameEmbed');
                if (iframe.requestFullscreen) {
                    iframe.requestFullscreen();
                } else if (iframe.mozRequestFullScreen) { /* Firefox */
                    iframe.mozRequestFullScreen();
                } else if (iframe.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                    iframe.webkitRequestFullscreen();
                } else if (iframe.msRequestFullscreen) { /* IE/Edge */
                    iframe.msRequestFullscreen();
                }
            });
        </script>

    </body>
</html>